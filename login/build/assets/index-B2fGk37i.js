import{r as h,j as e,R as Ce}from"./react-Cn7aBO_v.js";import{c as Ve}from"./react-dom-CPhoifT_.js";import{B as ke}from"./react-router-dom-PxoE90AR.js";import{u as De,N as Le,a as Fe,b as se}from"./react-router-_oI_BU7A.js";import{g as Ee}from"./firebase-C5yRtB7D.js";import{s as Re,t as Te,u as ne,v as y,w as N,x as j,y as f,z as P,A as V,B as qe,D as ae,G as Be,H as Pe,I as Ke,J as Oe,K as Ie}from"./@firebase-BfRov_rP.js";import{P as _e,B as Me}from"./react-chartjs-2-DQgHdg5b.js";import{C as Qe,A as Je,B as ze,p as Ge,h as Ue,j as $e,L as Ye}from"./chart.js-CVDD5LWP.js";import{p as He}from"./chartjs-plugin-datalabels-Dvj7BeUb.js";import{u as Q,w as We}from"./xlsx-DjuO7_Ju.js";/* empty css                  */import"./scheduler-CzFDRTuY.js";import"./@remix-run-DhJqR0mU.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@kurkle-BZxJdD1U.js";(function(){const A=document.createElement("link").relList;if(A&&A.supports&&A.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))g(i);new MutationObserver(i=>{for(const m of i)if(m.type==="childList")for(const u of m.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&g(u)}).observe(document,{childList:!0,subtree:!0});function c(i){const m={};return i.integrity&&(m.integrity=i.integrity),i.referrerPolicy&&(m.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?m.credentials="include":i.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function g(i){if(i.ep)return;i.ep=!0;const m=c(i);fetch(i.href,m)}})();const Xe=()=>{const[w,A]=h.useState(""),[c,g]=h.useState(""),[i,m]=h.useState(""),u=De(),L=async S=>{S.preventDefault(),w==="admin"&&c==="minhal468!"?(localStorage.setItem("isAuthenticated","true"),u("/AdminPage2")):m("שם המשתמש או הסיסמה שגויים")};return e.jsx("div",{className:"login-container",children:e.jsxs("div",{className:"login",children:[e.jsx("h2",{children:"התחברות כמנהל"}),e.jsxs("form",{onSubmit:L,children:[e.jsx("input",{type:"text",placeholder:"שם משתמש",value:w,onChange:S=>A(S.target.value),required:!0}),e.jsx("input",{type:"password",placeholder:"סיסמה",value:c,onChange:S=>g(S.target.value),required:!0}),e.jsx("button",{type:"submit",children:"התחבר"})]}),i&&e.jsx("p",{className:"error-message",children:i})]})})},Ze={apiKey:"AIzaSyBLJpEoG1mRGlXRrkRYv7RorKBR2OArfyg",authDomain:"community-registration-db.firebaseapp.com",projectId:"community-registration-db",storageBucket:"community-registration-db.appspot.com",messagingSenderId:"165140931406",appId:"1:165140931406:web:ac0a79861c2fdc80b2741f",measurementId:"G-YCEMVFBJV3"},J=Re(Ze);Ee(J);const l=Te(J);ne(J);Qe.register(Je,ze,Ge,Ue,$e,Ye,He);const et=()=>{var Z,ee;const[w,A]=h.useState([]),[c,g]=h.useState("statistics"),[i,m]=h.useState(null),[u,L]=h.useState({}),[S,o]=h.useState(null),[v,K]=h.useState({id:"",withKids:!1,whatsAppLink:""}),[R,re]=h.useState({}),[oe,ie]=h.useState(0),[x,z]=h.useState(null),[p,O]=h.useState(""),[k,le]=h.useState("name"),[T,q]=h.useState([]),[I,B]=h.useState([]),G=t=>{console.log("Volunteer details clicked: ",t),z(t)};h.useEffect(()=>{(async()=>{if(c==="editVolunteerAreas"){const a=(await f(y(l,"Volunteer Areas"))).docs.map(s=>({id:s.id,...s.data()}));A(a)}else if(c==="volunteerTable"||c==="approveVolunteers"||c==="statistics"){const a=(await f(y(l,"Volunteers"))).docs.map(s=>({id:s.data().id||"",firstName:s.data().firstName||"",lastName:s.data().lastName||"",email:s.data().email||"",phone:s.data().phone||"",gender:s.data().gender||"",startDate:s.data().startDate,volunteerArea:s.data().volunteerArea,confirmed:s.data().confirmed,policeForm:s.data().policeForm,BLform:s.data().BLform}));if(B(a),c==="statistics"){const s=a.filter(r=>r.confirmed).reduce((r,d)=>{var F;return(F=d.volunteerArea)==null||F.forEach(D=>{r[D]=(r[D]||0)+1}),r},{});re(s),ie(a.filter(r=>r.confirmed).length)}}})()},[c]);const ce=async()=>{const t=y(l,"Volunteers"),n=N(t,j("confirmed","==",!0)),a=await f(n);let s=[];a.forEach(r=>{s.push({id:r.id,...r.data()})}),B(s)};h.useEffect(()=>{ce(),_()},[]),h.useEffect(()=>{c==="volunteerTable"?p!==""?de():U():c==="editVolunteerAreas"&&he()},[p,k,c]);const U=async()=>{try{const t=y(l,"Volunteers"),n=N(t,j("confirmed","==",!0)),a=await f(n);let s=[];a.forEach(r=>{s.push({id:r.id,...r.data()})}),q(s)}catch(t){console.error("Error fetching all volunteers:",t)}},de=async()=>{try{const t=y(l,"Volunteers");let n=[];console.log("Starting search with:",{searchTerm:p,searchType:k});const a=N(t,j("confirmed","==",!0));if(k==="name"){const s=p.trim();console.log("Searching by name with term:",s);const r=N(a,j("firstName",">=",s),j("firstName","<=",s+"")),d=N(a,j("lastName",">=",s),j("lastName","<=",s+"")),[F,D]=await Promise.all([f(r),f(d)]),C=new Map;F.forEach(b=>{const E={id:b.id,...b.data()};C.set(b.id,E)}),D.forEach(b=>{const E={id:b.id,...b.data()};C.has(b.id)||C.set(b.id,E)}),n=Array.from(C.values())}else if(k==="id"){console.log("Searching by ID with term:",p);const s=N(a,j("id",">=",p),j("id","<=",p+""));(await f(s)).forEach(d=>{n.push({id:d.id,...d.data()})})}else if(k==="volunteerArea"){console.log("Searching by volunteer area with term:",p);const s=N(a,j("volunteerArea","array-contains",p));(await f(s)).forEach(d=>{n.push({id:d.id,...d.data()})})}console.log("Search results:",n),q(n)}catch(t){console.error("Error searching volunteers:",t)}},he=async()=>{const t=y(l,"Volunteer Areas");let n=[];if(p===""){q(w);return}const a=N(t,j("id",">=",p),j("id","<=",p+""));(await f(a)).forEach(r=>{n.push({id:r.id,...r.data()})}),q(n)},ue=async t=>{try{const n=y(l,"Volunteers"),a=await f(N(n,j("id","==",t)));if(a.empty)console.error("Volunteer not found");else{const s=a.docs[0].id;await P(V(l,"Volunteers",s)),U()}}catch(n){console.error("Error deleting volunteer:",n)}},me=()=>{const t=I.filter(s=>s.confirmed).map(s=>({"מספר תעודת זהות":s.id,"שם פרטי":s.firstName,"שם משפחה":s.lastName,"כתובת מייל":s.email,"מספר טלפון":s.phone,מין:s.gender,"תאריך התחלה":s.startDate?s.startDate.toDate().toLocaleDateString("he-IL"):"","תחום התנדבות":s.volunteerArea?s.volunteerArea.join(", "):""})),n=Q.json_to_sheet(t),a=Q.book_new();Q.book_append_sheet(a,n,"Confirmed Volunteers"),We(a,"ConfirmedVolunteers.xlsx")},_=async()=>{const n=(await f(y(l,"Volunteer Areas"))).docs.map(a=>({id:a.id,...a.data()}));A(n)},pe=async t=>{await P(V(l,"Volunteer Areas",t)),_(),o("התחום התנדבות נמחק בהצלחה"),setTimeout(()=>{o(null)},2500)},xe=t=>{m(t.id),L(t)},$=t=>{const{name:n,value:a}=t.target;L(s=>({...s,[n]:a}))},Y=t=>{const{name:n,value:a}=t.target;L(s=>({...s,[n]:a==="true"}))},fe=()=>{z(null)},je=async()=>{if(!u.id||u.withKids===void 0||!u.whatsAppLink){o("נא למלא את כל השדות."),setTimeout(()=>{o(null)},2500);return}if(i&&u.id!==i){await H(u),await ge(i);const t=await f(y(l,"Volunteers")),n=qe(l);t.forEach(a=>{const s=a.data();if(s.volunteerArea&&s.volunteerArea.includes(i)){const r=s.volunteerArea.map(d=>d===i?u.id:d);n.update(a.ref,{volunteerArea:r})}}),await n.commit()}else await ae(V(l,"Volunteer Areas",u.id),u);m(null),_(),o("התחום התנדבות עודכן בהצלחה"),setTimeout(()=>{o(null)},2500)},H=async t=>{await ae(V(l,"Volunteer Areas",t.id),t)},ge=async t=>{await P(V(l,"Volunteer Areas",t))},ye=()=>{m(null)},W=t=>{const{name:n,value:a}=t.target;K({...v,[n]:a})},X=t=>{K({...v,withKids:t.target.value==="true"})},ve=async()=>{if(!v.id||v.withKids===void 0||!v.whatsAppLink){o("נא למלא את כל השדות."),setTimeout(()=>{o(null)},2500);return}try{await H(v),o("התחום התנדבות נוסף בהצלחה"),setTimeout(()=>{o(null)},2500),K({id:"",withKids:!1,whatsAppLink:""})}catch(t){console.error("Error adding document: ",t),o("שגיאה בהוספת תחום התנדבות."),setTimeout(()=>{o(null)},2500)}},be=async t=>{try{console.log("Fetching volunteers...");const n=await f(y(l,"Volunteers"));console.log("Volunteers fetched successfully.");const a=n.docs.find(s=>s.data().id===t);if(a){const s=a.data();console.log("Volunteer found:",s);const r=[s.firstName,s.lastName,s.id,s.email,s.phone,s.volunteerArea[0]];console.log("Array created:",r);const d=await Be(V(l,"Volunteer Areas",s.volunteerArea[0]));if(!d.exists()){o(".תחום התנדבות לא נמצא"),setTimeout(()=>{o(null)},2500);return}const D=d.data().whatsAppLink;o("...המתן, מאשר מתנדב");const C=await fetch("http://localhost:5008/generate_pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({arr:r})});if(console.log("PDF generation request sent."),C.ok){console.log("PDF generated successfully.");const b=await C.blob(),E=`C:/BituahLeumiForms/${r[2]}.pdf`;B(Se=>Se.map(M=>M.id===t?{...M,confirmed:!0}:M)),o("...המתן, יוצר קובץ ביטוח לאומי");const Ae=ne(),te=Pe(Ae,`BituahLeumiForms/${r[2]}.pdf`);await Ke(te,b);const Ne=await Oe(te);await Ie(V(l,"Volunteers",a.id),{confirmed:!0,BLform:Ne}),console.log("Volunteer confirmed in Firestore."),o("...המתן, שולח מייל אישור"),await fetch("http://localhost:5008/approve_volunteer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email,pdf_path:E,whatsAppLink:D})}),console.log("Email sent successfully."),o("!המתנדב אושר בהצלחה")}else console.error("Error in PDF generation:",C.statusText),o("שגיאה ביצירת ה-PDF.");setTimeout(()=>{o(null)},2500)}else console.error("Volunteer not found."),o("מתנדב לא נמצא."),setTimeout(()=>{o(null)},2500)}catch(n){console.error("Error in handleApprove:  ",n),o("שגיאה באישור המתנדב."),setTimeout(()=>{o(null)},2500)}},we=async t=>{try{const a=(await f(y(l,"Volunteers"))).docs.find(s=>s.data().id===t);if(a){const s=a.data();await fetch("http://localhost:5008/reject_volunteer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email})}),await P(V(l,"Volunteers",a.id)),B(r=>r.filter(d=>d.id!==t)),o("המתנדב נדחה בהצלחה!"),setTimeout(()=>{o(null)},2500)}else console.error("Volunteer not found")}catch{o("שגיאה בדחיית המתנדב."),setTimeout(()=>{o(null)},2500)}};return e.jsx("div",{children:e.jsx("body",{children:e.jsxs("div",{className:"wrapper",children:[e.jsxs("div",{className:"header",children:[e.jsx("h2",{className:"header-title",children:"דף מנהל - מינהל קהילתי לב העיר"}),e.jsx("img",{src:"logo2.jpg",alt:"Logo",className:"logo",onClick:()=>g("statistics")})]}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"column middle",children:[S&&e.jsx("div",{className:"message",children:S}),c==="statistics"&&e.jsxs("div",{children:[e.jsx("h3",{className:"large-margin-bottom",children:"נתוני המינהל"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",gap:"100px"},children:[e.jsx("div",{style:{width:"45%",height:"400px"},children:e.jsx(_e,{data:{labels:Object.keys(R),datasets:[{data:Object.values(R),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40"]}]},options:{plugins:{datalabels:{formatter:(t,n)=>{const a=n.chart.data.datasets[0].data.reduce((r,d)=>r+d,0);return(t/a*100).toFixed(2)+"%"},color:"#fff",font:{size:14}},legend:{position:"top",labels:{font:{size:16}}}},maintainAspectRatio:!1},width:400,height:400})}),e.jsx("div",{style:{width:"45%",height:"400px"},children:e.jsx(Me,{data:{labels:Object.keys(R),datasets:[{label:"כמות מתנדבים",data:Object.values(R),backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!1}},maintainAspectRatio:!1},width:400,height:400})})]}),e.jsx("div",{children:e.jsx("p",{children:`סה"כ מתנדבים מאושרים: ${oe}`})})]}),c==="volunteerTable"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"large-margin-bottom",children:"טבלת מתנדבים מאושרים"}),e.jsxs("div",{className:"search-container",children:[e.jsx("button",{className:"export-button",onClick:me,children:"ייצוא לאקסל"}),e.jsxs("div",{className:"search-box",children:[e.jsxs("select",{value:k,onChange:t=>le(t.target.value),className:"search-select",children:[e.jsx("option",{value:"name",children:"שם"}),e.jsx("option",{value:"id",children:"תעודת זהות"}),e.jsx("option",{value:"volunteerArea",children:"תחום התנדבות"})]}),k==="volunteerArea"?e.jsxs("select",{value:p,onChange:t=>O(t.target.value),className:"search-select",children:[e.jsx("option",{value:"",children:"בחר תחום התנדבות"}),w.map(t=>e.jsx("option",{value:t.id,children:t.id},t.id))]}):e.jsx("input",{type:"text",value:p,onChange:t=>O(t.target.value),placeholder:"חיפוש",className:"search-input"})]})]}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"פעולות"}),e.jsx("th",{children:"תחום התנדבות"}),e.jsx("th",{children:"מס' תעודת זהות"}),e.jsx("th",{children:"שם"})]})}),e.jsx("tbody",{children:T.length===0&&p?e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,children:"לא נמצאו מתנדבים"})," "]}):(T.length>0?T:I).filter(t=>t.confirmed).map(t=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("button",{className:"action-button",onClick:()=>G(t),children:"הצג פרטים"}),e.jsx("button",{className:"action-button",onClick:()=>ue(t.id),children:"הסר"})]}),e.jsx("td",{children:Array.isArray(t.volunteerArea)?t.volunteerArea.join(", "):""}),e.jsx("td",{children:t.id}),e.jsxs("td",{children:[t.firstName," ",t.lastName]})]},t.id))})]})]}),x&&e.jsx("div",{className:"modal",style:{display:"flex"},children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:"modal-header",children:e.jsx("h4",{children:x.firstName+" "+x.lastName})}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{children:["מס' תעודת זהות: ",x.id]}),e.jsxs("p",{children:["Email: ",x.email]}),e.jsxs("p",{children:["מין: ",x.gender==="F"?"נקבה":"זכר"]}),e.jsxs("p",{children:["טלפון: ",x.phone]}),e.jsxs("p",{children:["תאריך התחלה: ",(Z=x.startDate)==null?void 0:Z.toDate().toLocaleDateString("he-IL")]}),e.jsxs("p",{children:["תחומי התנדבות: ",(ee=x.volunteerArea)==null?void 0:ee.join(", ")]}),e.jsxs("p",{children:["אושר: ",x.confirmed?"כן":"לא"]}),x.policeForm&&e.jsxs("p",{children:["אישור היעדר עבירות מין:"," ",e.jsx("a",{href:x.policeForm,target:"_blank",rel:"noopener noreferrer",children:"צפה בטופס"})]}),x.BLform&&e.jsxs("p",{children:["טופס ביטוח לאומי:"," ",e.jsx("a",{href:x.BLform,target:"_blank",rel:"noopener noreferrer",children:"צפה בטופס"})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"action-button",onClick:fe,children:"סגור"})})]})}),c==="editVolunteerAreas"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"large-margin-bottom",children:"עריכת תחומי התנדבות"}),e.jsx("div",{className:"search-container2",children:e.jsx("input",{type:"text",value:p,onChange:t=>O(t.target.value),placeholder:"חפש תחום התנדבות",className:"search-input2"})}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"פעולות"}),e.jsx("th",{children:"התנדבות עם ילדים"}),e.jsx("th",{children:"לינק לקבוצת הוואסטאפ"}),e.jsx("th",{children:"שם"})]})}),e.jsx("tbody",{children:(p?T:w).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:i===t.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"action-button",onClick:je,children:"שמור"}),e.jsx("button",{className:"action-button",onClick:ye,children:"ביטול"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"action-button",onClick:()=>pe(t.id),children:"הסר"}),e.jsx("button",{className:"action-button",onClick:()=>xe(t),children:"ערוך"})]})}),i===t.id?e.jsxs(e.Fragment,{children:[e.jsxs("td",{children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"withKids",value:"true",checked:u.withKids===!0,onChange:Y}),"כן"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"withKids",value:"false",checked:u.withKids===!1,onChange:Y}),"לא"]})]}),e.jsx("td",{children:e.jsx("input",{type:"text",name:"whatsAppLink",value:u.whatsAppLink||"",onChange:$})}),e.jsx("td",{children:e.jsx("input",{type:"text",name:"id",value:u.id,onChange:$,className:"align-right"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:t.withKids?"כן":"לא"}),e.jsx("td",{children:t.whatsAppLink}),e.jsx("td",{children:t.id})]})]},t.id))})]})]}),c==="approveVolunteers"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"large-margin-bottom",children:"אישור מתנדבים"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"פעולות"}),e.jsx("th",{children:"פרטים"}),e.jsx("th",{children:"מס' תעודת זהות"}),e.jsx("th",{children:"שם"})]})}),e.jsx("tbody",{children:I.filter(t=>!t.confirmed).map(t=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("button",{className:"action-button",onClick:()=>be(t.id),children:"אשר"}),e.jsx("button",{className:"action-button",onClick:()=>we(t.id),children:"דחה"})]}),e.jsx("td",{children:e.jsx("button",{className:"action-button",onClick:()=>G(t),children:"הצג פרטים"})}),e.jsx("td",{children:t.id}),e.jsxs("td",{children:[t.firstName," ",t.lastName]})]},t.id))})]})]}),c==="addVolunteerArea"&&e.jsxs("div",{children:[e.jsx("h3",{className:"large-margin-bottom",children:"הוספת תחום התנדבות"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:":שם"}),e.jsx("input",{type:"text",name:"id",value:v.id,onChange:W})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:":לינק לוואטסאפ"}),e.jsx("input",{type:"text",name:"whatsAppLink",value:v.whatsAppLink,onChange:W})]}),e.jsxs("div",{className:"form-group",children:[":עם ילדים",e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"withKids",value:"true",checked:v.withKids===!0,onChange:X}),"כן"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"withKids",value:"false",checked:v.withKids===!1,onChange:X}),"לא"]})]})]}),e.jsx("button",{className:"action-button",onClick:ve,children:"הוסף"})]})]}),e.jsx("div",{className:"column side",children:e.jsxs("ul",{className:"menu",children:[e.jsx("li",{onClick:()=>g("editVolunteerAreas"),children:"עריכת תחומי התנדבות"}),e.jsx("li",{onClick:()=>g("addVolunteerArea"),children:"הוספת תחום התנדבות"}),e.jsx("li",{onClick:()=>g("approveVolunteers"),children:"אישור מתנדבים"}),e.jsx("li",{onClick:()=>g("volunteerTable"),children:"טבלת מתנדבים"}),e.jsx("li",{onClick:()=>g("statistics"),children:"נתוני המינהל"})]})})]})}),e.jsx("div",{className:"footer",children:e.jsx("a",{href:"https://www.levhair.org.il/index.php",children:"חזרה לאתר המינהל"})})]})})})},tt=({children:w})=>localStorage.getItem("isAuthenticated")==="true"?e.jsx(e.Fragment,{children:w}):e.jsx(Le,{to:"/"});function st(){return e.jsx(ke,{children:e.jsxs(Fe,{children:[e.jsx(se,{path:"/",element:e.jsx(Xe,{})}),e.jsx(se,{path:"/AdminPage2",element:e.jsx(tt,{children:e.jsx(et,{})})})]})})}Ve.createRoot(document.getElementById("root")).render(e.jsx(Ce.StrictMode,{children:e.jsx(st,{})}));
