import{r as h,j as e,a as $}from"./react-nTLHQtbJ.js";import{c as B}from"./react-dom-Ddhjua3k.js";import{B as K}from"./react-router-dom-DQUMycjL.js";import{g as L}from"./firebase-Bn7KOxoS.js";import{s as P,t as z,u as O,v as R,w as S,x as M,y as G,z as Z,A as k,B as V,D as q,G as J,T as U,H as T,I as Y,J as H}from"./@firebase-BdFx1Qhg.js";import{a as Q,b as W}from"./react-router-BzBXiFRo.js";/* empty css                  */import"./scheduler-CzFDRTuY.js";import"./@remix-run-XGCIpbJN.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))m(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const p of t.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&m(p)}).observe(document,{childList:!0,subtree:!0});function r(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function m(a){if(a.ep)return;a.ep=!0;const t=r(a);fetch(a.href,t)}})();const X={apiKey:"AIzaSyBLJpEoG1mRGlXRrkRYv7RorKBR2OArfyg",authDomain:"community-registration-db.firebaseapp.com",projectId:"community-registration-db",storageBucket:"community-registration-db.appspot.com",messagingSenderId:"165140931406",appId:"1:165140931406:web:ac0a79861c2fdc80b2741f",measurementId:"G-YCEMVFBJV3"},N=P(X);L(N);const x=z(N),_=O(N),ee=()=>{const[j,g]=h.useState([]),[r,m]=h.useState({id:"",firstName:"",lastName:"",gender:"",phone:"",email:"",volunteerArea:"",policeApproval:null}),[a,t]=h.useState(""),[p,F]=h.useState(!1),[C,b]=h.useState(!1);h.useEffect(()=>{(async()=>{const l=(await R(S(x,"Volunteer Areas"))).docs.map(f=>({id:f.id,withKids:f.data().withKids}));g(l)})()},[]);const y=s=>/^[a-zA-Z\u0590-\u05FF\s]+$/.test(s),w=s=>/^[0-9]{9}$/.test(s),E=s=>/^05\d{8}$/.test(s),D=s=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(s),d=s=>{const{name:o,value:l,type:f}=s.target;if((o==="firstName"||o==="lastName")&&(y(l)?t(""):t("שם פרטי או משפחה לא תקין")),o==="id"&&(w(l)?t(""):t("מספר תעודת זהות לא תקין")),o==="phone"&&(E(l)?t(""):t("מספר טלפון לא תקין")),o==="email"&&(D(l)?t(""):t("כתובת מייל לא תקינה")),f==="file"){const n=s.target,u=n.files?n.files[0]:null;u&&o==="policeApproval"&&u.type!=="application/pdf"?(t("PDF העלה קובץ רק מסוג"),m({...r,[o]:null}),b(!0)):(t(""),m({...r,[o]:u}),b(!1))}else if(f==="checkbox"){const n=s.target;m({...r,[o]:n.checked})}else m({...r,[o]:l});if(o==="volunteerArea"){const n=j.find(u=>u.id===l);F(n?n.withKids:!1)}},I=async s=>{if(s.preventDefault(),!y(r.firstName)){t("שם פרטי לא תקין");return}if(!y(r.lastName)){t("שם משפחה לא תקין");return}if(!w(r.id)){t("מספר תעודת זהות לא תקין");return}if(!E(r.phone)){t("מספר טלפון לא תקין");return}if(!D(r.email)){t("כתובת מייל לא תקינה");return}if(p&&r.gender==="Male"&&(!r.policeApproval||r.policeApproval.type!=="application/pdf")){t("סוג קובץ לא תקין");return}t(""),console.log("Form submitted:",r);let o=null;if(r.policeApproval){const i=M(_,`policeForms/${r.id}/${r.policeApproval.name}`);try{await G(i,r.policeApproval),o=await Z(i),console.log("Police form uploaded:",o)}catch(c){console.error("Error uploading police approval: ",c),c instanceof Error?t(`Failed to upload police approval. Error: ${c.message}`):t("Failed to upload police approval due to an unknown error.");return}}const l=S(x,"Volunteers"),f=k(l),n=await R(f);console.log("Volunteers query snapshot:",n);const u=n.docs.find(i=>i.data().id===r.id);if(u){const i=V(x,"Volunteers",u.id),c=u.data();console.log("Existing volunteer data:",c);const v=Array.isArray(c.volunteerArea)?[...new Set([...c.volunteerArea,r.volunteerArea])]:[r.volunteerArea];try{await q(i,{firstName:r.firstName,lastName:r.lastName,gender:r.gender==="male"?"M":"F",phone:r.phone,email:r.email,volunteerArea:v,policeForm:o||c.policeForm}),console.log("Volunteer details updated successfully!"),alert("!פרטי המתנדב עודכנו בהצלחה")}catch(A){console.error("Error updating document: ",A),A instanceof Error?t(`Failed to update volunteer details. Error: ${A.message}`):t("Failed to update volunteer details due to an unknown error.");return}}else try{await J(l,{id:r.id,firstName:r.firstName,lastName:r.lastName,gender:r.gender==="male"?"M":"F",phone:r.phone,email:r.email,startDate:U.now(),volunteerArea:[r.volunteerArea],confirmed:!1,policeForm:o}),alert("!טופס נשלח בהצלחה")}catch(i){console.error("Error adding document: ",i),i instanceof Error?t(`Failed to add volunteer. Error: ${i.message}`):t("Failed to add volunteer due to an unknown error.");return}if(o){const i=V(x,"Police Forms",r.id),c=await T(i);try{c.exists()?await q(i,{Form:Y(o)}):await H(i,{Form:[o]})}catch(v){console.error("Error updating police forms: ",v),v instanceof Error?t(`Failed to update police forms. Error: ${v.message}`):t("Failed to update police forms due to an unknown error.");return}}m({id:"",firstName:"",lastName:"",gender:"",phone:"",email:"",volunteerArea:"",policeApproval:null}),F(!1)};return e.jsx("div",{className:"create-container",children:e.jsxs("div",{className:"create",children:[e.jsx("h2",{className:"main-title",children:"דף הרשמה למתנדב חדש"}),e.jsx("h4",{className:"sub-title",children:"מינהל קהילתי לב העיר"}),a&&e.jsx("p",{style:{color:"red"},children:a}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lastName",children:"שם משפחה"}),e.jsx("input",{type:"text",id:"lastName",name:"lastName",value:r.lastName,onChange:d,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"firstName",children:"שם פרטי"}),e.jsx("input",{type:"text",id:"firstName",name:"firstName",value:r.firstName,onChange:d,required:!0})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"id",children:"מס' תעודת זהות"}),e.jsx("input",{type:"text",id:"id",name:"id",value:r.id,onChange:d,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",children:"כתובת מייל"}),e.jsx("input",{type:"email",id:"email",name:"email",value:r.email,onChange:d,required:!0})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",children:"מס' טלפון"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:r.phone,onChange:d,required:!0})]}),e.jsxs("div",{className:"gender-row",children:[e.jsx("label",{children:"מין"}),e.jsxs("div",{className:"radio-group",children:[e.jsx("label",{htmlFor:"female",children:"נקבה"}),e.jsx("input",{type:"radio",id:"female",name:"gender",value:"female",onChange:d,required:!0}),e.jsx("label",{htmlFor:"male",children:"זכר"}),e.jsx("input",{type:"radio",id:"male",name:"gender",value:"male",onChange:d,required:!0})]})]})]}),e.jsx("div",{className:"form-row full-width",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"volunteer",children:"תחום התנדבות"}),e.jsxs("select",{id:"volunteer",name:"volunteerArea",value:r.volunteerArea,onChange:d,required:!0,children:[e.jsx("option",{value:"",children:"בחר תחום התנדבות"}),j.map(s=>e.jsx("option",{value:s.id,children:s.id},s.id))]})]})}),r.gender==="male"&&p&&e.jsx("div",{className:"form-row center",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"policeApproval",children:"אישור היעדר עבירות מין (חובה)"}),e.jsx("input",{type:"file",id:"policeApproval",name:"policeApproval",onChange:d,required:r.gender==="male"&&p})]})}),e.jsx("button",{type:"submit",disabled:C,children:"שלח טופס"})," "]})]})})};function re(){return e.jsx(K,{children:e.jsx(Q,{children:e.jsx(W,{path:"/",element:e.jsx(ee,{})})})})}B.createRoot(document.getElementById("root")).render(e.jsx($.StrictMode,{children:e.jsx(re,{})}));
